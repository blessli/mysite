[{"content":"é—®é¢˜æ¢ç´¢ äº‹ä»¶å¤„ç† å…¶ä»– vscodeæœ¬åœ°è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 { \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;debug nginx\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;cppdbg\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;program\u0026#34;: \u0026#34;${workspaceFolder}/objs/nginx\u0026#34;, \u0026#34;stopAtEntry\u0026#34;: false, \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34;, \u0026#34;environment\u0026#34;: [], \u0026#34;externalConsole\u0026#34;: false } ] } mkcertåˆ›å»ºè‡ªç­¾åSSLè¯ä¹¦ 1 2 3 mkcert -install # å°† mkcert çš„è®¤è¯æœºæ„å®‰è£…åˆ°æœåŠ¡å™¨ä¸Š mkcert -CAROOT # æŸ¥çœ‹ CA è¯ä¹¦çš„ä½ç½®ï¼Œåœ¨PCä¸Šå®‰è£… rootCA.crt è¯ä¹¦ mkcert www.aaa.com aiPlatform.dev localhost 127.0.0.1 ::1 43.139.87.74 # ç”Ÿæˆè¯ä¹¦ï¼Œé…ç½®åœ¨nginx.confä¸­ nginxå››å±‚è½¬å‘ æºç ç¼–è¯‘æ—¶ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰‹åŠ¨åŠ è½½streamæ¨¡å—:\n./auto/configure \u0026ndash;with-http_ssl_module \u0026ndash;prefix=/home/github/nginx \u0026ndash;with-stream\nç„¶ååœ¨nginx.confæ·»åŠ ä»¥ä¸‹é…ç½®å†…å®¹æ”¯æŒtcpè½¬å‘ï¼Œstream_backendç¨‹åº: 1 2 3 4 5 6 7 8 9 10 11 12 stream { upstream stream_backend { zone tcp_servers 64k; hash $remote_addr; server 127.0.0.1:18000; } server { listen 8000; proxy_pass stream_backend; } } ","date":"2022-11-22T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img1.png","permalink":"https://soli.seekincs.com/2022/11/nginx-source-code-learning/","title":"nginx source code learning"},{"content":"é—®é¢˜æ¢ç´¢ è°ƒåº¦å™¨ å…¶ä»– ç¼–è¯‘ ç¼–è¯‘è„šæœ¬(all.bash/make.bash)ä¸­æ³¨é‡Šæ‰ï¼Œè·³è¿‡ç¼–è¯‘testï¼Œå› ä¸ºå¤ªæ…¢\nmkdir -p ~/mygo/bin cd ~/mygo/bin ln -sf /usr/local/projs/go/bin/go mygo mygo version mygo run helloworld.go ","date":"2022-11-14T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img6.png","permalink":"https://soli.seekincs.com/2022/11/go-source-code-learning/","title":"go source code learning"},{"content":"wiresharkæ•è·grpcæ¶ˆæ¯ ","date":"2022-11-14T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img5.png","permalink":"https://soli.seekincs.com/2022/11/grpcgo-source-code-learning/","title":"grpcgo source code learning"},{"content":"è·¨vpcæ­å»ºk8sé›†ç¾¤ é›†æˆsidecar todo\n","date":"2022-11-14T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img4.png","permalink":"https://soli.seekincs.com/2022/11/k8s-cluster-in-action/","title":"k8s cluster in Action"},{"content":"centosç‰ˆæœ¬\ncat /etc/redhat-release alias è§£å†³é‡å¯åaliaså¤±æ•ˆé—®é¢˜ï¼š\nvim ~/.bashrc alias cdcode='cd /usr/local/projs' source ~/.bashrc æŸ¥çœ‹é¡¹ç›®ä»£ç è¡Œæ•° yum -y install cloc cloc src æ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹å¤§å° du -hs å®‰è£…git2.x sudo yum install https://packages.endpointdev.com/rhel/7/os/x86_64/endpoint-repo.x86_64.rpm sudo yum install git git --version git config --global user.name \u0026quot;Your Name\u0026quot; git config --global user.email \u0026quot;email@example.com\u0026quot; ssh-keygen -t rsa -C \u0026quot;your_email@youremail.com\u0026quot; cat /root/.ssh/id_rsa.pub gccå‡çº§åˆ°7.13 sudo yum install centos-release-scl sudo yum install devtoolset-7-gcc* ln -sf /opt/rh/devtoolset-7/root/usr/bin/gcc /usr/bin/gcc ln -sf /opt/rh/devtoolset-7/root/usr/bin/g++ /usr/bin/g++ å®‰è£…cmake3 yum -y install cmake3 sudo ln -s /usr/bin/cmake3 /usr/bin/cmake cmake --version å®‰è£…æŒ‡å®šç‰ˆæœ¬\nwget https://github.com/Kitware/CMake/releases/download/v3.24.0/cmake-3.24.0-linux-x86_64.tar.gz tar -zxvf cmake-3.24.0-linux-x86_64.tar.gz ln -sf /usr/local/cmake-3.24.0-linux-x86_64/bin/cmake /usr/bin/cmake linuxå¼€å¯swapåˆ†åŒº dd if=/dev/zero of=/swapfile bs=64M count=64 chmod 0600 /swapfile mkswap /swapfile swapon /swapfile swapon -s https://www.cnblogs.com/Axianba/p/13131620.html\nå®‰è£…mysql-8.0.24 cmakeå‘½ä»¤\nmkdir build \u0026amp;\u0026amp; cd build cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local/mysql -DMYSQL_DATADIR=/usr/local/mysql/data -DCMAKE_C_COMPILER=/usr/bin/gcc -DCMAKE_CXX_COMPILER=/usr/bin/g++ -DSYSCONFDIR=/etc -DWITH_BOOST=/usr/local/boost -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DENABLED_LOCAL_INFILE=ON -DWITH_INNODB_MEMCACHED=ON -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_FEDERATED_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 -DWITH_PERFSCHEMA_STORAGE_ENGINE=1 -DFORCE_INSOURCE_BUILD=1 -DMYSQL_TCP_PORT=3306 ç¼–è¯‘ï¼Œå®‰è£…ï¼Œåˆå§‹åŒ–ï¼Œå¯åŠ¨ï¼š\ngroupadd mysql useradd -r -g mysql -s /bin/false mysql make\u0026amp;\u0026amp;make install chown -R mysql:mysql /usr/local/mysql/ /usr/local/mysql/bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data /usr/local/mysql/bin/mysqld_safe --defaults-file=/usr/local/mysql/etc/my.cnf ","date":"2022-11-14T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img7.png","permalink":"https://soli.seekincs.com/2022/11/linux-cmd-collection/","title":"linux cmd collection"},{"content":"æŒ‡å— èƒ½åšæŒåˆ°/çœ‹åˆ°è¿™é‡Œçš„ï¼Œé‚£ç»å£æ˜¯çœŸçˆ±ï¼ï¼ èµ é€ä¸¤ä¸ªå°å°çš„å»ºè®® å»ºè®®ä¸€ï¼š ä»handlerå‡ºå‘ MySQLæ’ä»¶å¼å¼•æ“ï¼Œè¿æ¥MySQL Serverä¸å„ç§å­˜å‚¨å¼•æ“çš„ï¼Œæ˜¯å…¶Handler æ¨¡å— â€”â€” hanlderæ¨¡å—æ˜¯çµé­‚ï¼› ä»¥InnoDBå¼•æ“ä¸ºä¾‹ï¼Œä»ha_innodb.ccæ–‡ä»¶å‡ºå‘ï¼Œç†è§£å…¶ä¸­çš„æ¯ä¸€ä¸ªæ¥å£çš„ åŠŸèƒ½ï¼Œèƒ½å¤Ÿä¸Šè¾¾MySQL Serverï¼Œä¸‹æŠµInnoDBå¼•æ“çš„å†…éƒ¨å®ç°ï¼› å»ºè®®äºŒï¼š ä¸æ”¾è¿‡æºç ä¸­çš„æ¯ä¸€å¤„æ³¨é‡Š MySQL/InnoDBæºç ä¸­ï¼Œæœ‰å¾ˆå¤šæ³¨é‡Šï¼Œä¸€äº›æ³¨é‡Šç›¸å½“è¯¦ç»†ï¼Œå¯¹ç†è§£æŸä¸€ä¸ª å‡½æ•°/æŸä¸€ä¸ªåŠŸèƒ½æ¨¡å—éƒ½ç›¸å½“æœ‰ç”¨ï¼› é—®é¢˜æ¢ç´¢ ä¸€æ¡SQLçš„ç”Ÿå‘½å‘¨æœŸ å‚è€ƒæ–‡ç« \nmysqlæ’ä»¶åŒ–æ¶æ„ mysql8.0å–æ¶ˆæŸ¥è¯¢ç¼“å­˜ å®˜æ–¹è¯´æ˜\nç½‘ç»œIOæ¨¡å‹ å‚è€ƒæ–‡ç« \nå…¶ä»– mysql8.0.24æºç ç¼–è¯‘å®‰è£… ä¸»è¦æ˜¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œæ“ä½œè¿‡ç¨‹ä¸­æ ¹æ®æŠ¥é”™è¿›è¡Œfixï¼Œç‰¹åˆ«æ˜¯ä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶ã€‚\nç¼–è¯‘å®‰è£…é—®é¢˜ OpenSSL ç‰ˆæœ¬ä¸å…¼å®¹\nä¸å…¼å®¹1.1ç‰ˆæœ¬ï¼Œéœ€è¦openssl1.0.2ï¼Œé€šè¿‡yum install openssl-develã€‚\nç£ç›˜ç©ºé—´ä¸è¶³\n60gç£ç›˜æ»¡äº†ï¼Œå¯¼è‡´make ç»ˆæ­¢ï¼Œ/dataç›®å½•åˆ æ‰å³å¯ã€‚\nfatal error: error writing to /tmp/ccFtecZv.s: No space left on device å†…å­˜ä¸è¶³\néœ€è¦å¼€å¯swapåˆ†åŒº g++: internal compiler error: Killed (program cc1plus) å¤ªåƒå†…å­˜ï¼Œmakeå·¨æ…¢\næ²¡æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ\u0026hellip; ç¼ºå°‘ä¾èµ–ç»„ä»¶\nå¯èƒ½æ˜¯ç¼ºå°‘ncurses-devel yum install ncurses-devel libaio bison zlib-devel openssl openssl-devel patch mysqldå¯åŠ¨é—®é¢˜ ç£ç›˜ç©ºé—´ä¸è¶³ æ³¨æ„my.cnfé…ç½®æ–‡ä»¶ï¼Œç‰¹åˆ«innodbå‚æ•°é…ç½®ï¼Œå¯èƒ½å› ç³»ç»Ÿå†…å­˜æˆ–ç£ç›˜å®¹é‡å¯¼è‡´å¯åŠ¨å¤±è´¥\næŸ¥çœ‹ç³»ç»Ÿç£ç›˜: df -h\n[InnoDB] Error number 28 means \u0026lsquo;No space left on device\u0026rsquo;\nvscodeæœ¬åœ°è°ƒè¯•mysql8.0.24 å…ˆåœ¨äº‘æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n./mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data launch.jsoné…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;debug mysql\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;cppdbg\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;program\u0026#34;: \u0026#34;/usr/local/mysql/bin/mysqld\u0026#34;, \u0026#34;args\u0026#34;: [\u0026#34;--defaults-file=/usr/local/mysql/etc/my.cnf\u0026#34;], \u0026#34;stopAtEntry\u0026#34;: false, \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34;, \u0026#34;environment\u0026#34;: [], \u0026#34;externalConsole\u0026#34;: false } ] } æºç ç»“æ„ å®‰è£…treeå·¥å…·ï¼Œæ‰§è¡Œtree -d -L 1å‘½ä»¤ï¼š\n|-- build |-- client |-- cmake |-- components |-- Docs |-- doxygen_resources |-- extra |-- include |-- libbinlogevents |-- libbinlogstandalone |-- libmysql |-- libservices |-- man |-- mysql-test |-- mysys |-- packaging |-- plugin |-- router |-- scripts |-- share |-- source_downloads |-- sql |-- sql-common |-- storage |-- strings |-- support-files |-- testclients |-- unittest |-- utilities `-- vio è¯­é›€ä»£ç ç”»æ—¶åºå›¾ï¼š https://www.bookstack.cn/read/yuque/34.md\nMysqlçº¿ç¨‹çš„åŸºæœ¬è®¾ç½® mysql\u0026gt; show variables like 'thread%'; +-------------------+---------------------------+ | Variable_name | Value | +-------------------+---------------------------+ | thread_cache_size | 1536 | | thread_handling | one-thread-per-connection | | thread_stack | 524288 | +-------------------+---------------------------+ 3 rows in set (0.05 sec) mysql\u0026gt; show global status like 'Thread%'; +-------------------+-------+ | Variable_name | Value | +-------------------+-------+ | Threads_cached | 0 | | Threads_connected | 1 | | Threads_created | 1 | | Threads_running | 1 | +-------------------+-------+ 4 rows in set (0.07 sec) è¿œç¨‹è¿æ¥ rootå¿˜è®°å¯†ç \n--- mysqldæ¨¡å—ä¸‹å¢åŠ skip-grant-tablesé…ç½®,å…å¯†ç™»å½•åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š update user set authentication_string = '' where user ='root'; --- æ³¨é‡Šæ‰skip-grant-tablesé…ç½®,é‡æ–°ç™»å½•ï¼Œè®¾ç½®æ–°å¯†ç ï¼š ALTER USER 'root'@'localhost' IDENTIFIED BY 'root123456'; å…è®¸å¤–éƒ¨è®¿é—®\nuse mysql; update user set host='%' where user ='root'; FLUSH PRIVILEGES; æµ‹è¯•mermaid sequenceDiagram participant Alice participant Bob Alice-\u003e\u003eJohn: Hello John, how are you? loop Healthcheck John-\u003eJohn: Fight against hypochondria end Note right of John: Rational thoughts prevail... John--\u003eAlice: Great! John-\u003eBob: How about you? Bob--\u003eJohn: Jolly good! ","date":"2022-11-14T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img2.png","permalink":"https://soli.seekincs.com/2022/11/mysql-source-code-learning/","title":"mysql source code learning"},{"content":"é—®é¢˜æ¢ç´¢ äº‹ä»¶å¤„ç† å…¶ä»– vscodeæœ¬åœ°è°ƒè¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \u0026#34;version\u0026#34;: \u0026#34;0.2.0\u0026#34;, \u0026#34;configurations\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;debug redis\u0026#34;, \u0026#34;type\u0026#34;: \u0026#34;cppdbg\u0026#34;, \u0026#34;request\u0026#34;: \u0026#34;launch\u0026#34;, \u0026#34;program\u0026#34;: \u0026#34;${workspaceFolder}/src/redis-server\u0026#34;, \u0026#34;args\u0026#34;: [\u0026#34;redis.conf\u0026#34;], \u0026#34;stopAtEntry\u0026#34;: false, \u0026#34;cwd\u0026#34;: \u0026#34;${workspaceFolder}\u0026#34;, \u0026#34;environment\u0026#34;: [], \u0026#34;externalConsole\u0026#34;: false } ] } redis-benchmarkå‹æµ‹ 1 2 3 4 5 cd /usr/local/projs/redis/src \u0026amp;\u0026amp; ./redis-benchmark -h ./redis-benchmark -t set -n 1000000 -r 100000000 47496.91 requests per second ./redis-benchmark -t set -n 1000000 -r 100000000 -P 16 291290.41 requests per second æŸ¥çœ‹RDBå¿«ç…§æ–‡ä»¶ rdb -c memory dump.rdb \u0026gt; dump_rdb.csv\nå…¶ä¸­ï¼šsize_in_bytes å†…å­˜çš„å¤§å°ï¼Œç”±æ­¤å¯ä»¥æŸ¥è¯¢å†…å­˜æœ€é«˜çš„key\nå‚è€ƒèµ„æ–™ Redisä¸­æ–‡ç½‘ ","date":"2022-11-14T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img1.png","permalink":"https://soli.seekincs.com/2022/11/redis-source-code-learning/","title":"redis source code learning"},{"content":"EMQXå®‰è£…éƒ¨ç½² EMQX æ˜¯ä¸€æ¬¾å¤§è§„æ¨¡å¯å¼¹æ€§ä¼¸ç¼©çš„äº‘åŸç”Ÿåˆ†å¸ƒå¼ç‰©è”ç½‘ MQTT æ¶ˆæ¯æœåŠ¡å™¨ğŸ˜‚ã€‚\nDockerå•èŠ‚ç‚¹å¤šå®ä¾‹ åŸºäºdocker-compose+haproxyæ­å»ºä¼ªåˆ†å¸ƒå¼é›†ç¾¤ï¼š\nå¯åŠ¨ï¼šdocker-compose -f docker-compose-emqx-cluster.yaml up\nå…³é—­ï¼šdocker-compose -f docker-compose-emqx-cluster.yaml down\nDockerå¤šèŠ‚ç‚¹ ä¿®æ”¹emqx.confé…ç½®æ–‡ä»¶(è¿™é‡Œé€‰æ‹©staticæ–¹å¼)ï¼Œé›†ç¾¤èŠ‚ç‚¹å¼€æ”¾æŸäº›ç«¯å£ï¼š\ncluster.discovery = static cluster.static.seeds = emqx@120.92.94.79,emqx@120.92.88.242 rpc.port_discovery = manual rpc.tcp_server_port = 5369 ä¸¤ä¸ªé›†ç¾¤èŠ‚ç‚¹åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ndocker run -d --name emqx_cluster -v /emqx.conf:/opt/emqx/etc/emqx.conf -v /emqx_auth_mysql.conf:/opt/emqx/etc/plugins/emqx_auth_mysql.conf -v /loaded_plugins:/opt/emqx/data/loaded_plugins --env EMQX_LOG__TO=both --env EMQX_HOST=120.92.94.79 -p 1883:1883 -p 8081:8081 -p 8083:8083 -p 8084:8084 -p 8883:8883 -p 18083:18083 -p 4370:4370 -p 5370:5370 -p 4369:4369 -p 5369:5369 -p 6369:6369 -p 6370:6370 emqx/emqx:4.4.4 k8sé›†ç¾¤ è§å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼Œä¼ é€é—¨\nå®‰å…¨ å®‰å…¨ä¸»è¦åŒ…æ‹¬æœåŠ¡ç«¯è®¿é—®æ§åˆ¶å’Œå®¢æˆ·ç«¯SDKå®‰å…¨ï¼Œå…·ä½“å¦‚ä¸‹ï¼š\næœåŠ¡ç«¯å¯ç”¨emqx_auth_mysqlæ’ä»¶å®ç°è®¤è¯å’Œæˆæƒã€‚\nå®¢æˆ·ç«¯SDKå¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ï¼Œ è¦èµ°ä¸­å°ç»Ÿä¸€çš„ä¸‰æ–¹åº“æŠ¥å¤‡ã€å®¡æŸ¥ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ¼æ´æˆ–å…¶ä»–é£é™©ã€‚\nå®¢æˆ·ç«¯SDK ä¸€äº›SDKä¸æ”¯æŒmqtt5.0ï¼Œå…¶å½±å“æ˜¯pub/subæ“ä½œæ— æ³•æ‹¿åˆ°åŸå› ç ã€‚ä¸€äº›SDKä¸æ”¯æŒæ–­çº¿é‡è¿ã€‚\næ³¨æ„ç‚¹ï¼šclient_idå°½é‡ä¸å¡«(æˆ–è€…é‡è¿æ—¶é‡‡ç”¨ç¬¬ä¸€æ¬¡è¿æ¥åè¿”å›çš„client_id)ï¼Œé¿å…client_idé‡å¤å¯¼è‡´ä¼šè¯äº’è¸¢ã€‚\nGoç‰ˆæœ¬å»ºè®®é€‰æ‹©paho.golangï¼Œå› ä¸ºæ”¯æŒ5.0åè®®ã€‚\nC++ç‰ˆæœ¬å»ºè®®é€‰æ‹©paho.mqtt.cppï¼Œä¹Ÿå¯ä»¥å‚è€ƒæˆ‘å†™çš„ä¸€ä¸ªåŸºäºvcpkg+cmakeçš„demo\nJSç‰ˆæœ¬å»ºè®®é€‰æ‹©ws-mqtt\nå‹åŠ›éªŒè¯ å‹æµ‹å·¥å…·\nç¡¬ä»¶é…ç½®ï¼šä¸€å°è…¾è®¯äº‘æœåŠ¡å™¨2c4gã€‚\nä¸€ä¸ªmasterèŠ‚ç‚¹çš„k8sä¸Šè¿è¡Œemqx 6ä¸ªpodï¼Œç›®å‰åªèƒ½æ”¯æŒ27322ä¸ªè®¢é˜…ç«¯ï¼ŒæœåŠ¡å™¨CPU 100%ã€‚\né‡åˆ°çš„é—®é¢˜ client(4): EXIT for {shutdown,eaddrinuse}\nè§£å†³æ–¹æ³•ï¼š\næ‰©å¤§ç«¯å£æ•°é‡\næé«˜ç«¯å£ä½¿ç”¨ç‡\n","date":"2022-11-13T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img1.png","permalink":"https://soli.seekincs.com/2022/11/mqtt-broker-in-action/","title":"MQTT Broker in Action"},{"content":"\nèƒŒæ™¯ å½“éœ€è¦æä¾›ä¸€ç§æ–°èƒ½åŠ›ï¼Œè€ƒè™‘åˆ°æˆæœ¬é—®é¢˜ï¼Œæˆ‘ä»¬å¾€å¾€ä¸ä¼šä»0åˆ°1å¼€å‘ä¸€ä¸ªæœåŠ¡å™¨ï¼Œè€Œæ˜¯å…ˆåœ¨å¼€æºäº§å“ä¸­é€‰å‹å¯¹æ¯”ï¼Œçœ‹æ˜¯å¦å·²æœ‰èƒ½æ»¡è¶³è‡ªèº«éœ€æ±‚çš„å¼€æºäº§å“(ä¸é‡å¤é€ è½®å­çš„åŸåˆ™)ã€‚å› ä¸ºå¯¹å¼€æºæœåŠ¡å™¨çš„ä¸ç†Ÿæ‚‰ï¼Œéƒ¨ç½²è¿‡ç¨‹ä¸­ä¼šè¸©è¿™æ ·é‚£æ ·çš„å‘ï¼Œæ•ˆç‡æ¯”è¾ƒä½ï¼Œå¦‚ä½•å¿«é€Ÿéƒ¨ç½²å¹¶åº”ç”¨äºå®é™…ä¸šåŠ¡åœºæ™¯å‘¢ï¼Ÿ\néšä¾¿æä¸€ä¸‹ï¼Œç§æœ‰åŒ–éƒ¨ç½²çš„åŸå› ä¸»è¦æ˜¯è€ƒè™‘åˆ°æ•°æ®å®‰å…¨ï¼Œå®‰å…¨æ— å°äº‹ï¼Œå®‰å…¨å¤§äºä¸€åˆ‡ å‡†å¤‡å·¥ä½œ äº‘ä¸»æœº(å†…éƒ¨å®‰è£…äº†dockerã€docker-composeã€é˜²ç«å¢™å¼€æ”¾æŒ‡å®šç«¯å£) ä¸ªäººç”µè„‘(å†…éƒ¨å®‰è£…äº†docker-desktopã€xshellã€vscodeã€golang) ä»”ç»†çœ‹å®˜æ–¹æ–‡æ¡£ä»¥åŠå®˜æ–¹å¼€æºç¤¾åŒº æ³¨æ„ï¼šemqxæ˜¯4.4.4ç‰ˆæœ¬\néƒ¨ç½² é¢„æœŸæ•ˆæœ (é…ç½®æ–‡ä»¶ã€æ—¥å¿—)æ–‡ä»¶/ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ç£ç›˜\nç›‘æ§ã€å‘Šè­¦ã€å¯è§†åŒ–ç­‰åŠŸèƒ½\nåè®®æ¥å…¥ã€é›†ç¾¤éƒ¨ç½²ã€æ¥å…¥å®‰å…¨ å…·ä½“æµç¨‹ ä¸ªäººç”µè„‘ -\u0026gt; äº‘ä¸»æœº\nå•æœºç‰ˆ -\u0026gt; é›†ç¾¤ç‰ˆ(è´Ÿè½½å‡è¡¡) å¯åŠ¨ ä»”ç»†æ£€æŸ¥docker-compose-emqx-cluster.yaml é…ç½®æ–‡ä»¶ï¼Œå¦åˆ™ä¼šå¯åŠ¨å¤±è´¥\nå¯åŠ¨å‘½ä»¤ï¼š docker-compose -f docker-compose-emqx-cluster.yaml up \u0026amp; é€€å‡ºå‘½ä»¤ï¼š docker-compose -f docker-compose-emqx-cluster.yaml down æ¥å…¥å®‰å…¨ æœåŠ¡ç«¯è®¿é—®æ§åˆ¶ åœ¨loaded_pluginsé…ç½®æ–‡ä»¶ä¸­å¯ç”¨emqx_auth_mysqlæ’ä»¶ã€‚ 1 2 3 4 5 6 7 8 9 {emqx_management,true}. {emqx_dashboard,true}. {emqx_modules,false}. {emqx_recon,true}. {emqx_retainer,true}. {emqx_telemetry,true}. {emqx_rule_engine,true}. {emqx_bridge_mqtt,false}. {emqx_auth_mysql,true}. emqxé»˜è®¤æ˜¯ä¸è®¾ç½®æƒé™ï¼Œéœ€è¦ä¿®æ”¹acl.confå¯ç”¨é‰´æƒã€‚ 1 2 3 {allow, {user, \u0026#34;dashboard\u0026#34;}, subscribe, [\u0026#34;$SYS/#\u0026#34;]}. {allow, {ipaddr, \u0026#34;127.0.0.1\u0026#34;}, pubsub, [\u0026#34;$SYS/#\u0026#34;, \u0026#34;#\u0026#34;]}. {deny, all, subscribe, [\u0026#34;$SYS/#\u0026#34;, {eq, \u0026#34;#\u0026#34;}]}. ä¿®æ”¹emqx_auth_mysql.confé…ç½®æ–‡ä»¶ï¼šä¿®æ”¹æ•°æ®åº“å®ä¾‹ï¼Œåˆ›å»ºè®¤è¯è¡¨å’Œæˆæƒè¡¨ã€‚\nç”¨æˆ·å/å¯†ç è®¤è¯é˜²æ­¢éæ³•å®¢æˆ·ç«¯è¿æ¥ã€‚ 1 2 3 4 5 6 7 8 9 10 CREATE TABLE `mqtt_user` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `username` varchar(100) DEFAULT NULL, `password` varchar(100) DEFAULT NULL, `salt` varchar(35) DEFAULT NULL, `is_superuser` tinyint(1) DEFAULT \u0026#39;0\u0026#39;, `created` datetime DEFAULT NULL, PRIMARY KEY (`id`), UNIQUE KEY `mqtt_username` (`username`) ) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8mb4 å¯¹ MQTT å®¢æˆ·ç«¯çš„å‘å¸ƒå’Œè®¢é˜…æ“ä½œè¿›è¡Œæƒé™æ§åˆ¶ã€‚æ§åˆ¶å“ªäº›å®¢æˆ·ç«¯å¯ä»¥å‘å¸ƒæˆ–è€…è®¢é˜…å“ªäº›MQTTä¸»é¢˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 CREATE TABLE `mqtt_acl` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT, `allow` int(1) DEFAULT \u0026#39;1\u0026#39; COMMENT \u0026#39;0: deny, 1: allow\u0026#39;, `ipaddr` varchar(60) DEFAULT NULL COMMENT \u0026#39;IpAddress\u0026#39;, `username` varchar(100) DEFAULT NULL COMMENT \u0026#39;Username\u0026#39;, `clientid` varchar(100) DEFAULT NULL COMMENT \u0026#39;ClientId\u0026#39;, `access` int(2) NOT NULL COMMENT \u0026#39;1: subscribe, 2: publish, 3: pubsub\u0026#39;, `topic` varchar(100) NOT NULL DEFAULT \u0026#39;\u0026#39; COMMENT \u0026#39;Topic Filter\u0026#39;, PRIMARY KEY (`id`), KEY `ipaddr` (`ipaddr`), KEY `username` (`username`), KEY `clientid` (`clientid`) ) ENGINE=InnoDB AUTO_INCREMENT=13 DEFAULT CHARSET=utf8mb4 å®¢æˆ·ç«¯SDKå®‰å…¨ SDKå¼•å…¥äº†ç¬¬ä¸‰æ–¹åº“ï¼Œ è¦èµ°ä¸­å°ç»Ÿä¸€çš„ä¸‰æ–¹åº“æŠ¥å¤‡ã€å®¡æŸ¥ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ¼æ´æˆ–å…¶ä»–é£é™© ã€‚ é›†ç¾¤éƒ¨ç½² å®é™…ä¸šåŠ¡åœºæ™¯å¯èƒ½å¯¹é«˜æ€§èƒ½ã€é«˜å¯ç”¨æœ‰ç€ä¸€å®šè¦æ±‚ã€‚è¿™é‡Œä»¥ä¼ªåˆ†å¸ƒå¼é›†ç¾¤ä¸ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 version: \u0026#39;3.9\u0026#39; x-default-emqx: \u0026amp;default-emqx image: emqx/emqx:4.4.4 env_file: - conf.cluster.env healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;/opt/emqx/bin/emqx_ctl\u0026#34;, \u0026#34;status\u0026#34;] interval: 5s timeout: 25s retries: 5 services: haproxy: container_name: haproxy image: haproxy:2.4 privileged: true depends_on: - emqx1 - emqx2 volumes: - ./haproxy/haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg - ./certs_ha/certs:/usr/local/etc/haproxy/certs ports: - \u0026#34;18083:18083\u0026#34; - \u0026#34;1883:1883\u0026#34; # - \u0026#34;8883:8883\u0026#34; - \u0026#34;8083:8083\u0026#34; # - \u0026#34;8084:8084\u0026#34; - \u0026#34;9090:9090\u0026#34; - \u0026#34;8081:8081\u0026#34; networks: - emqx_bridge working_dir: /usr/local/etc/haproxy command: - bash - -c - | set -x cat /usr/local/etc/haproxy/certs/cert.pem /usr/local/etc/haproxy/certs/key.pem \u0026gt; /tmp/emqx.pem haproxy -f /usr/local/etc/haproxy/haproxy.cfg emqx1: \u0026lt;\u0026lt;: *default-emqx container_name: node1.emqx.io environment: - \u0026#34;EMQX_HOST=node1.emqx.io\u0026#34; ports: - \u0026#34;18081:18083\u0026#34; - \u0026#34;8881:8083\u0026#34; - \u0026#34;1882:1883\u0026#34; - \u0026#34;18087:8081\u0026#34; networks: emqx_bridge: aliases: - node1.emqx.io volumes: - ./dockeremqx/emqx.conf:/opt/emqx/etc/emqx.conf - ./dockeremqx/acl.conf:/opt/emqx/etc/acl.conf - ./dockeremqx/emqx_auth_mysql.conf:/opt/emqx/etc/plugins/emqx_auth_mysql.conf - ./dockeremqx/loaded_plugins:/opt/emqx/data/loaded_plugins - ./dockeremqx/emqx1_log/log:/opt/emqx/log emqx2: \u0026lt;\u0026lt;: *default-emqx container_name: node2.emqx.io environment: - \u0026#34;EMQX_HOST=node2.emqx.io\u0026#34; ports: - \u0026#34;18082:18083\u0026#34; - \u0026#34;8882:8083\u0026#34; - \u0026#34;1881:1883\u0026#34; - \u0026#34;18088:8081\u0026#34; networks: emqx_bridge: aliases: - node2.emqx.io volumes: - ./dockeremqx/emqx.conf:/opt/emqx/etc/emqx.conf - ./dockeremqx/acl.conf:/opt/emqx/etc/acl.conf - ./dockeremqx/emqx_auth_mysql.conf:/opt/emqx/etc/plugins/emqx_auth_mysql.conf - ./dockeremqx/loaded_plugins:/opt/emqx/data/loaded_plugins - ./dockeremqx/emqx2_log/log:/opt/emqx/log networks: emqx_bridge: driver: bridge name: emqx_bridge # ipam: # driver: default # config: # - subnet: 172.100.239.0/24 # gateway: 172.100.239.1 åè®®æ¥å…¥ åº”ç”¨å±‚åè®®åŒ…æ‹¬mqttã€websocketã€httpã€‚è´Ÿè½½å‡è¡¡å™¨æ–¹é¢çš„é…ç½®éå¸¸å…³é”®ï¼Œä¸‹é¢ä»¥haproxyä¸ºä¾‹(æ ¸å¿ƒé…ç½®)ï¼š\nç²˜æ€§ä¼šè¯æ˜¯åœ¨haproxyä¸­é…ç½®çš„ã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 defaults log global mode http option httplog # Replace 1024000 with deployment connections maxconn 50000 timeout connect 30000 timeout client 600s timeout server 600s timeout tunnel 1h timeout client-fin 30s timeout http-keep-alive 5s timeout http-request 5s frontend emqx_tcp mode tcp option tcplog bind *:1883 # Reject connections that have an invalid MQTT packet # tcp-request content reject unless { req.payload(0,0), mqtt_is_valid } default_backend emqx_tcp_back frontend emqx_ws mode tcp option httplog bind *:8083 acl host_ws hdr_beg(Host) -i ws. acl hdr_connection_upgrade hdr(Connection) -i upgrade acl hdr_upgrade_websocket hdr(Upgrade) -i websocket use_backend emqx_ws_back if hdr_connection_upgrade hdr_upgrade_websocket default_backend emqx_ws_back backend emqx_tcp_back mode tcp stick on req.payload(0,0),mqtt_field_value(connect,client_identifier) server emqx-1 node1.emqx.io:1883 check-send-proxy send-proxy-v2 server emqx-2 node2.emqx.io:1883 check-send-proxy send-proxy-v2 backend emqx_ws_back mode http balance roundrobin acl hdr_connection_upgrade hdr(Connection) -i upgrade acl hdr_upgrade_websocket hdr(Upgrade) -i websocket acl hdr_websocket_key hdr_cnt(Sec-WebSocket-Key) eq 1 acl hdr_websocket_version hdr_cnt(Sec-WebSocket-Version) eq 1 server emqx-1 node1.emqx.io:8083 server emqx-2 node2.emqx.io:8083 æµ‹è¯• åŠŸèƒ½æµ‹è¯• ç›®æ ‡ï¼šè¿æ¥ã€å‘å¸ƒã€è®¢é˜…ç­‰åŠŸèƒ½ç¬¦åˆé¢„æœŸã€‚\nEMQXæ˜¯å¦æ­£åœ¨è¿è¡Œçš„åˆ¤æ–­æ–¹æ³•ï¼šæ­£å¸¸è¿›å…¥ç®¡ç†åå°ç•Œé¢ã€æ­£å¸¸ç›‘å¬æŸäº›æŒ‡å®šç«¯å£ã€‚\nè¿è¡ŒæŒ‡å®šè¯­è¨€çš„å®¢æˆ·ç«¯SDKæ¥è¿›è¡Œå…³é”®åŠŸèƒ½æµ‹è¯•ï¼Œæ¯”å¦‚golangç‰ˆæœ¬çš„SDK paho.golang ï¼ŒJSç‰ˆæœ¬çš„SDK mqtt-client-WebSocket ã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å®˜æ–¹æ¨èçš„å¯è§†åŒ–å·¥å…·æ¥æµ‹è¯•ã€‚ æµ‹è¯•æ–¹æ³• æµ‹è¯•ç‚¹ æœŸæœ›ç»“æœ å…·ä½“è¯´æ˜ å®¢æˆ·ç«¯æ–­çº¿é‡è¿ emqxé‡å¯åï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨é‡è¿ å–å†³äºå®¢æˆ·ç«¯SDKæ˜¯å¦å®ç°äº†å¿ƒè·³é‡è¿ æ¶ˆæ¯ä¸‹å‘æˆåŠŸç‡ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒQoS 1æŠ¥æ–‡ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ Brokeræä¾›3ç§QoSï¼Œé€šå¸¸é€‰æ‹©QoS 1æŠ¥æ–‡(è‡³å°‘é€è¾¾ä¸€æ¬¡)æ¥å…¼é¡¾ååé‡å’Œå‘å¸ƒè´¨é‡ã€‚ æ¶ˆæ¯çŠ¶æ€ç  æ¯æ¬¡æ“ä½œéƒ½èƒ½æ‹¿åˆ°å®æ—¶ä¸”æ­£ç¡®çš„çŠ¶æ€ç  çŠ¶æ€ç æ˜¯MQTT 5.0æ–°ç‰¹æ€§ï¼Œå®¢æˆ·ç«¯SDKéœ€è¦æ”¯æŒ5.0åè®® æ€§èƒ½æµ‹è¯• ç›®æ ‡ï¼šç¡®è®¤æ˜¯å¦ä¸å®˜æ–¹å®£ç§°çš„æ€§èƒ½æ¥è¿‘(æœºå™¨ç¡¬ä»¶æ¡ä»¶ç›¸åŒæƒ…å†µä¸‹)ï¼Œæå‰æš´éœ²å¯èƒ½å­˜åœ¨çš„BUG æµ‹è¯•æ–¹æ³• ä¸€èˆ¬å®˜æ–¹éƒ½ä¼šæä¾›é…å¥—çš„å‹æµ‹å·¥å…·è„šæœ¬ï¼Œæ¯”å¦‚emqtt-benchå¼€æºé¡¹ç›®ï¼Œå°†å…¶è¿è¡Œåœ¨äº‘ä¸»æœºï¼Œå‹æµ‹æ•ˆæœæœ€å¥½ï¼Œå‡å°‘ç½‘ç»œä¼ è¾“æ—¶å»¶ã€‚ 1 ./emqtt_bench sub -t bench -h ${ip} -p 1883 -c 1000 -i 10 -q 1 -u ${username}-P ${password} å‹æµ‹æ³¨æ„äº‹é¡¹ å‹æµ‹å®¢æˆ·ç«¯è¢«é™åˆ¶ï¼šulimitå‘½ä»¤ä¿®æ”¹è¿›ç¨‹æœ€å¤§è¿æ¥æ•°é™åˆ¶ï¼Œå¦åˆ™ä¼šå‹æµ‹ä¸å‡†ï¼Œæœ€å¤§å¹¶å‘è¿æ¥æ•°å¡åœ¨1007ä¸Šä¸å»ã€‚\nå‘å¸ƒç«¯å‘é€æ¶ˆæ¯é€Ÿç‡è¿‡å¿«ï¼š max_mqueue_lenå‚æ•°é»˜è®¤ä¸º1000ï¼Œé˜Ÿåˆ—æ»¡ä¼šæ¶ˆæ¯å‘é€å¤±è´¥ è´Ÿè½½å‡è¡¡å™¨maxconnè®¾ç½®è¿‡å°ï¼šhaproxyçš„maxconné»˜è®¤å€¼æ˜¯1000ï¼Œéœ€è¦è°ƒå¤§ä¸º50000\næ€»ç»“ æ­å»ºå¼€æºæœåŠ¡å™¨ï¼Œéœ€è¦å®ç°åè®®æ¥å…¥ã€é›†ç¾¤éƒ¨ç½²ã€æ¥å…¥å®‰å…¨ç­‰æ ¸å¿ƒåŠŸèƒ½æ¥æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œæœ€ç»ˆç›®çš„æ˜¯ä¸ºä¸šåŠ¡å¸¦æ¥ä¸€å®šçš„ä»·å€¼ã€‚\n","date":"2022-10-30T00:00:00Z","image":"https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img1.png","permalink":"https://soli.seekincs.com/2022/10/%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E5%BC%80%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"å¦‚ä½•å¿«é€Ÿéƒ¨ç½²å¼€æºæœåŠ¡å™¨"}]