<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>mqtt on soli</title>
        <link>https://soli.seekincs.com/categories/mqtt/</link>
        <description>Recent content in mqtt on soli</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Sun, 13 Nov 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://soli.seekincs.com/categories/mqtt/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>MQTT Broker in Action</title>
        <link>https://soli.seekincs.com/2022/11/mqtt-broker-in-action/</link>
        <pubDate>Sun, 13 Nov 2022 00:00:00 +0000</pubDate>
        
        <guid>https://soli.seekincs.com/2022/11/mqtt-broker-in-action/</guid>
        <description>&lt;img src="https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img1.png" alt="Featured image of post MQTT Broker in Action" /&gt;&lt;h2 id=&#34;emqxå®‰è£…éƒ¨ç½²&#34;&gt;EMQXå®‰è£…éƒ¨ç½²&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;EMQX æ˜¯ä¸€æ¬¾å¤§è§„æ¨¡å¯å¼¹æ€§ä¼¸ç¼©çš„äº‘åŸç”Ÿåˆ†å¸ƒå¼ç‰©è”ç½‘ MQTT æ¶ˆæ¯æœåŠ¡å™¨ğŸ˜‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;dockerå•èŠ‚ç‚¹å¤šå®ä¾‹&#34;&gt;Dockerå•èŠ‚ç‚¹å¤šå®ä¾‹&lt;/h3&gt;
&lt;p&gt;åŸºäºdocker-compose+haproxyæ­å»ºä¼ªåˆ†å¸ƒå¼é›†ç¾¤ï¼š&lt;br&gt;
å¯åŠ¨ï¼šdocker-compose -f docker-compose-emqx-cluster.yaml up&lt;br&gt;
å…³é—­ï¼šdocker-compose -f docker-compose-emqx-cluster.yaml down&lt;/p&gt;
&lt;h3 id=&#34;dockerå¤šèŠ‚ç‚¹&#34;&gt;Dockerå¤šèŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;ä¿®æ”¹emqx.confé…ç½®æ–‡ä»¶(è¿™é‡Œé€‰æ‹©staticæ–¹å¼)ï¼Œé›†ç¾¤èŠ‚ç‚¹å¼€æ”¾æŸäº›ç«¯å£ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-conf&#34;&gt;cluster.discovery = static
cluster.static.seeds = emqx@120.92.94.79,emqx@120.92.88.242
rpc.port_discovery = manual
rpc.tcp_server_port = 5369
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;ä¸¤ä¸ªé›†ç¾¤èŠ‚ç‚¹åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;docker run -d --name emqx_cluster -v /emqx.conf:/opt/emqx/etc/emqx.conf -v /emqx_auth_mysql.conf:/opt/emqx/etc/plugins/emqx_auth_mysql.conf -v /loaded_plugins:/opt/emqx/data/loaded_plugins --env EMQX_LOG__TO=both --env EMQX_HOST=120.92.94.79 -p 1883:1883 -p 8081:8081 -p 8083:8083 -p 8084:8084 -p 8883:8883 -p 18083:18083 -p 4370:4370 -p 5370:5370 -p 4369:4369 -p 5369:5369 -p 6369:6369 -p 6370:6370 emqx/emqx:4.4.4
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;k8sé›†ç¾¤&#34;&gt;k8sé›†ç¾¤&lt;/h3&gt;
&lt;p&gt;è§å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼Œä¼ é€é—¨&lt;/p&gt;
&lt;h2 id=&#34;å®‰å…¨&#34;&gt;å®‰å…¨&lt;/h2&gt;
&lt;p&gt;å®‰å…¨ä¸»è¦åŒ…æ‹¬æœåŠ¡ç«¯è®¿é—®æ§åˆ¶å’Œå®¢æˆ·ç«¯SDKå®‰å…¨ï¼Œå…·ä½“å¦‚ä¸‹ï¼š&lt;br&gt;
æœåŠ¡ç«¯å¯ç”¨emqx_auth_mysqlæ’ä»¶å®ç°è®¤è¯å’Œæˆæƒã€‚&lt;br&gt;
å®¢æˆ·ç«¯SDKå¼•å…¥çš„ç¬¬ä¸‰æ–¹åº“ï¼Œ è¦èµ°ä¸­å°ç»Ÿä¸€çš„ä¸‰æ–¹åº“æŠ¥å¤‡ã€å®¡æŸ¥ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ¼æ´æˆ–å…¶ä»–é£é™©ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®¢æˆ·ç«¯sdk&#34;&gt;å®¢æˆ·ç«¯SDK&lt;/h2&gt;
&lt;p&gt;ä¸€äº›SDKä¸æ”¯æŒmqtt5.0ï¼Œå…¶å½±å“æ˜¯pub/subæ“ä½œæ— æ³•æ‹¿åˆ°åŸå› ç ã€‚ä¸€äº›SDKä¸æ”¯æŒæ–­çº¿é‡è¿ã€‚&lt;br&gt;
æ³¨æ„ç‚¹ï¼šclient_idå°½é‡ä¸å¡«(æˆ–è€…é‡è¿æ—¶é‡‡ç”¨ç¬¬ä¸€æ¬¡è¿æ¥åè¿”å›çš„client_id)ï¼Œé¿å…client_idé‡å¤å¯¼è‡´ä¼šè¯äº’è¸¢ã€‚&lt;br&gt;
Goç‰ˆæœ¬å»ºè®®é€‰æ‹©&lt;a class=&#34;link&#34; href=&#34;https://github.com/eclipse/paho.golang&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;paho.golang&lt;/a&gt;ï¼Œå› ä¸ºæ”¯æŒ5.0åè®®ã€‚&lt;br&gt;
C++ç‰ˆæœ¬å»ºè®®é€‰æ‹©&lt;a class=&#34;link&#34; href=&#34;https://github.com/eclipse/paho.mqtt.cpp&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;paho.mqtt.cpp&lt;/a&gt;ï¼Œä¹Ÿå¯ä»¥å‚è€ƒæˆ‘å†™çš„&lt;a class=&#34;link&#34; href=&#34;https://github.com/blessli/mqtt-cpp-demo&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ä¸€ä¸ªåŸºäºvcpkg+cmakeçš„demo&lt;/a&gt;&lt;br&gt;
JSç‰ˆæœ¬å»ºè®®é€‰æ‹©&lt;a class=&#34;link&#34; href=&#34;https://github.com/emqx/MQTT-Client-Examples/blob/master/mqtt-client-WebSocket/ws-mqtt.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ws-mqtt&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å‹åŠ›éªŒè¯&#34;&gt;å‹åŠ›éªŒè¯&lt;/h2&gt;
&lt;p&gt;&lt;a class=&#34;link&#34; href=&#34;https://github.com/emqx/emqtt-bench&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;å‹æµ‹å·¥å…·&lt;/a&gt;&lt;br&gt;
ç¡¬ä»¶é…ç½®ï¼šä¸€å°è…¾è®¯äº‘æœåŠ¡å™¨2c4gã€‚&lt;br&gt;
ä¸€ä¸ªmasterèŠ‚ç‚¹çš„k8sä¸Šè¿è¡Œemqx 6ä¸ªpodï¼Œç›®å‰åªèƒ½æ”¯æŒ27322ä¸ªè®¢é˜…ç«¯ï¼ŒæœåŠ¡å™¨CPU 100%ã€‚&lt;br&gt;&lt;/p&gt;
&lt;h3 id=&#34;é‡åˆ°çš„é—®é¢˜&#34;&gt;é‡åˆ°çš„é—®é¢˜&lt;/h3&gt;
&lt;p&gt;client(4): EXIT for {shutdown,eaddrinuse}&lt;br&gt;
è§£å†³æ–¹æ³•ï¼š&lt;br&gt;
æ‰©å¤§ç«¯å£æ•°é‡&lt;br&gt;
æé«˜ç«¯å£ä½¿ç”¨ç‡&lt;br&gt;
&lt;img src=&#34;https://soli.seekincs.com/2022/11/mqtt-broker-in-action/static/emqtt-bench-result.png&#34;
	width=&#34;1564&#34;
	height=&#34;709&#34;
	srcset=&#34;https://soli.seekincs.com/2022/11/mqtt-broker-in-action/static/emqtt-bench-result_hud14d66730ab45c2af3ddfad68006f28b_105763_480x0_resize_box_3.png 480w, https://soli.seekincs.com/2022/11/mqtt-broker-in-action/static/emqtt-bench-result_hud14d66730ab45c2af3ddfad68006f28b_105763_1024x0_resize_box_3.png 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;emqtt-bench-result.png&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;220&#34;
		data-flex-basis=&#34;529px&#34;
	
&gt;&lt;/p&gt;</description>
        </item>
        <item>
        <title>MQTTæ¶ˆæ¯æœåŠ¡å™¨åœ¨ç¨»å£³æœåŠ¡è½åœ°</title>
        <link>https://soli.seekincs.com/2022/10/mqtt%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%A8%E7%A8%BB%E5%A3%B3%E6%9C%8D%E5%8A%A1%E8%90%BD%E5%9C%B0/</link>
        <pubDate>Fri, 28 Oct 2022 00:00:00 +0000</pubDate>
        
        <guid>https://soli.seekincs.com/2022/10/mqtt%E6%B6%88%E6%81%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9C%A8%E7%A8%BB%E5%A3%B3%E6%9C%8D%E5%8A%A1%E8%90%BD%E5%9C%B0/</guid>
        <description>&lt;img src="https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/img1.png" alt="Featured image of post MQTTæ¶ˆæ¯æœåŠ¡å™¨åœ¨ç¨»å£³æœåŠ¡è½åœ°" /&gt;&lt;h2 id=&#34;mqttæ˜¯ä»€ä¹ˆ&#34;&gt;MQTTæ˜¯ä»€ä¹ˆ&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;MQTT åè®®çš„å…¨ç§°æ˜¯ Message Queuing Telemetry Transportï¼Œç¿»è¯‘ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾“æ¢æµ‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;MQTTæ˜¯ä¸€ä¸ªè½»é‡çš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ¶ˆæ¯ä¼ è¾“åè®®ï¼Œä¸“é—¨é’ˆå¯¹ä½å¸¦å®½å’Œä¸ç¨³å®šç½‘ç»œç¯å¢ƒçš„ç‰©è”ç½‘åº”ç”¨è®¾è®¡ã€‚&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/WechatIMG214.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;mqttçš„ç‰¹ç‚¹åŠåº”ç”¨&#34;&gt;MQTTçš„ç‰¹ç‚¹åŠåº”ç”¨&lt;/h3&gt;
&lt;h4 id=&#34;ç‰¹ç‚¹&#34;&gt;ç‰¹ç‚¹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å¼€æ”¾æ¶ˆæ¯åè®®ï¼Œç®€å•æ˜“å®ç°&lt;/li&gt;
&lt;li&gt;å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œä¸€å¯¹å¤šæ¶ˆæ¯å‘å¸ƒ&lt;/li&gt;
&lt;li&gt;åŸºäºTCP/IPç½‘ç»œè¿æ¥&lt;/li&gt;
&lt;li&gt;1å­—èŠ‚å›ºå®šæŠ¥å¤´ï¼Œ2å­—èŠ‚å¿ƒè·³æŠ¥æ–‡ï¼ŒæŠ¥æ–‡ç»“æ„ç´§å‡‘&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯QoSæ”¯æŒï¼Œå¯é ä¼ è¾“ä¿è¯&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;åº”ç”¨&#34;&gt;åº”ç”¨&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å†…ç½‘æœåŠ¡è°ƒç”¨ï¼Œæ¯”å¦‚ä»£ç æ„å»ºæœåŠ¡&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ’ä»¶ä¸‹å‘&lt;/li&gt;
&lt;li&gt;ç«™å†…ä¿¡/æ¶ˆæ¯ä¸­å¿ƒ&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡å¼€å…³&lt;/li&gt;
&lt;li&gt;æ”¯ä»˜çŠ¶æ€å›è°ƒï¼ˆå‰ç«¯æ¥æ”¶ï¼‰&lt;/li&gt;
&lt;li&gt;é¡µé¢æ–¹æ³•è°ƒç”¨ï¼ˆä¸‹å‘ä¸€æ®µjsè„šæœ¬ï¼ŒinnerHTMLåˆ°é¡µé¢æ‰§è¡Œï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;mqttåè®®æ•°æ®åŒ…&#34;&gt;MQTTåè®®æ•°æ®åŒ…&lt;/h3&gt;
&lt;p&gt;ä»WiresharkæŠ“åŒ…å·¥å…·ä¸­å¯ä»¥çœ‹åˆ°MQTTåè®®ä½äºåº”ç”¨å±‚ï¼Œåè®®ç»“æ„ç®€å•ï¼Œåˆ†åˆ«ç”±å›ºå®šå¤´ã€å¯å˜å¤´ã€æ¶ˆæ¯ä½“ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæœ€å¤šå¯ä»¥æœ‰16ç§æŠ¥æ–‡ç±»å‹ã€‚&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG212.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;fixed-header&#34;&gt;Fixed Header&lt;/h4&gt;
&lt;p&gt;æ‰€æœ‰MQTTæŠ¥æ–‡ç±»å‹éƒ½åŒ…å«&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG213.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;variable-header&#34;&gt;Variable Header&lt;/h4&gt;
&lt;p&gt;ä¸åŒçš„æŠ¥æ–‡ç±»å‹ä¼šä¸åŒï¼Œæ¯”å¦‚PUBACKæŠ¥æ–‡ã€CONNECTæŠ¥æ–‡&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG210.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;payload&#34;&gt;Payload&lt;/h4&gt;
&lt;p&gt;ä¸åŒçš„æŠ¥æ–‡ç±»å‹ä¼šä¸åŒï¼Œæ¯”å¦‚CONNECTæŠ¥æ–‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¶ˆæ¯å‘å¸ƒè´¨é‡qos&#34;&gt;æ¶ˆæ¯å‘å¸ƒè´¨é‡(QoS)&lt;/h3&gt;
&lt;p&gt;è®¢é˜…è€…æ”¶åˆ°MQTTæ¶ˆæ¯çš„QoSçº§åˆ«ï¼Œæœ€ç»ˆå–å†³äºå‘å¸ƒæ¶ˆæ¯çš„QoSå’Œä¸»é¢˜è®¢é˜…çš„QoS(å–ä¸¤è€…æœ€å°)ã€‚&lt;br&gt;
QoS 0ï¼šæ¶ˆæ¯è‡³å¤šé€è¾¾ä¸€æ¬¡ (At most once delivery)&lt;br&gt;
å…è®¸æ¶ˆæ¯å°‘é‡ä¸¢å¤±ï¼Œæœ€å¤šä¼ è¾“ä¸€æ¬¡&lt;br&gt;
QoS 1ï¼šæ¶ˆæ¯è‡³å°‘é€è¾¾ä¸€æ¬¡ (At least once delivery)&lt;br&gt;
ç¡®ä¿æ¶ˆæ¯ä¸€å®šåˆ°è¾¾ï¼Œå¯å°‘é‡é‡å¤&lt;br&gt;
QoS 2ï¼šæ¶ˆæ¯åªé€è¾¾ä¸€æ¬¡ (Exactly once delivery)&lt;br&gt;
é¿å…æ¶ˆæ¯é‡å¤æˆ–ä¸¢å¤±ä¼šå¯¼è‡´ä¸æ­£ç¡®çš„ç»“æœ
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG209.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;mqttåœ¨æœåŠ¡ç«¯çš„åº”ç”¨-ç¨»å£³pcå‰ç«¯æ’ä»¶æ„å»ºä»»åŠ¡ä¸‹å‘ä¸ºä¾‹&#34;&gt;MQTTåœ¨æœåŠ¡ç«¯çš„åº”ç”¨-ç¨»å£³PCå‰ç«¯æ’ä»¶æ„å»ºä»»åŠ¡ä¸‹å‘ä¸ºä¾‹&lt;/h2&gt;
&lt;h3 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h3&gt;
&lt;p&gt;å‰ç«¯æ’ä»¶æ‰“åŒ…éœ€è¦ä»gitä»“åº“æ‹‰å–ä»£ç ï¼Œè€ƒè™‘åˆ°å®‰å…¨é—®é¢˜ï¼Œä»£ç æ„å»ºæœåŠ¡éƒ¨ç½²åœ¨å†…ç½‘é‡‘å±±äº‘ä¸»æœºä¸Šã€‚åœ¨å‰ç«¯åŒå­¦æäº¤å·¥å•åï¼Œè¿ç»´äººå‘˜éœ€è¦æ‰‹åŠ¨å‘èµ·æ„å»ºä»»åŠ¡ç”Ÿæˆçš„ç‰ˆæœ¬å·å†é…ç½®åœ¨å¯¹OPåå°ã€‚&lt;br&gt;
ä¸ºäº†é™ä½äººå·¥è¿ç»´æˆæœ¬ï¼Œå°†åŸæœ¬äººå·¥å¤„ç†å‡çº§ä¸ºè‡ªåŠ¨åŒ–PCç«¯æ’ä»¶ä¸‹å‘ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦è§£å†³å¤–ç½‘æœåŠ¡å¦‚ä½•è°ƒç”¨å†…ç½‘æœåŠ¡çš„é—®é¢˜(æ³¨ï¼šä»£ç æ„å»ºæœåŠ¡éƒ¨ç½²åœ¨å†…ç½‘ï¼Œæ— æ³•è¢«å¤–ç½‘æœåŠ¡å¯»å€åˆ°)ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¾è®¡ä¸å®ç°&#34;&gt;è®¾è®¡ä¸å®ç°&lt;/h3&gt;
&lt;p&gt;è®¾è®¡ç†å¿µï¼šè®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªé—´æ¥çš„ä¸­é—´å±‚æ¥è§£å†³ã€‚&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG208.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;æ ¸å¿ƒä»£ç &#34;&gt;æ ¸å¿ƒä»£ç &lt;/h4&gt;
&lt;p&gt;è®¢é˜…ç«¯æ–­çº¿è‡ªåŠ¨é‡è¿ï¼Œå¹¶è‡ªåŠ¨è®¢é˜…æˆåŠŸçš„å…³é”®ä»£ç &lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-golang&#34;&gt;func NewMqtt() {
    serverURL, err := url.Parse(&amp;quot;tcp://xxx.xxx.xxx.xxx:1883&amp;quot;)
    if err != nil {
        panic(fmt.Errorf(&amp;quot;environmental variable %s must be a valid URL (%w)&amp;quot;, serverURL, err))
    }
    h := NewHandler(true, &amp;quot;sub.log&amp;quot;, true)
    defer h.Close()

    cliCfg := autopaho.ClientConfig{
        BrokerUrls: []*url.URL{serverURL},
        KeepAlive:  30,
        OnConnectionUp: func(cm *autopaho.ConnectionManager, connAck *paho.Connack) {
            fmt.Println(&amp;quot;mqtt connection up&amp;quot;)
            if _, err := cm.Subscribe(context.Background(), &amp;amp;paho.Subscribe{
                Subscriptions: map[string]paho.SubscribeOptions{
                    &amp;quot;testtopic&amp;quot;: {QoS: byte(1)}, // è®¢é˜…testtopicä¸»é¢˜
                },
            }); err != nil {
                fmt.Printf(&amp;quot;failed to subscribe (%s). This is likely to mean no messages will be received.&amp;quot;, err)
                return
            }
            fmt.Println(&amp;quot;mqtt subscription made&amp;quot;)
        },
        OnConnectError: func(err error) { fmt.Printf(&amp;quot;error whilst attempting connection: %s\n&amp;quot;, err) },
        ClientConfig: paho.ClientConfig{
            ClientID: &amp;quot;deploy.docer.wps.cn&amp;quot;, // å®¢æˆ·ç«¯æ ‡è¯†
            Router: paho.NewSingleHandlerRouter(func(m *paho.Publish) {
                h.handle(m) // ä¸šåŠ¡é€»è¾‘å¤„ç†
            }),
            OnClientError: func(err error) { fmt.Printf(&amp;quot;server requested disconnect: %s\n&amp;quot;, err) },
            OnServerDisconnect: func(d *paho.Disconnect) {
                if d.Properties != nil {
                    fmt.Printf(&amp;quot;server requested disconnect: %s\n&amp;quot;, d.Properties.ReasonString)
                } else {
                    fmt.Printf(&amp;quot;server requested disconnect; reason code: %d\n&amp;quot;, d.ReasonCode)
                }
            },
        },
    }
    cliCfg.SetConnectPacketConfigurator(func(c *paho.Connect) *paho.Connect {
        c.CleanStart = false // å¼€å¯æŒä¹…ä¼šè¯
        return c
    })
    cliCfg.SetUsernamePassword(config.Config.Mqtt.Username, []byte(config.Config.Mqtt.Password)) // ç”¨æˆ·å/å¯†ç è®¤è¯
    cliCfg.Debug = logger{prefix: &amp;quot;autoPaho&amp;quot;}
    cliCfg.PahoDebug = logger{prefix: &amp;quot;paho&amp;quot;}
    //
    // Connect to the broker
    //
    ctx, cancel := context.WithCancel(context.Background())
    defer cancel()
    cm, err := autopaho.NewConnection(ctx, cliCfg)
    if err != nil {
        panic(err)
    }
    sig := make(chan os.Signal, 1)
    signal.Notify(sig, os.Interrupt)
    signal.Notify(sig, syscall.SIGTERM)

    &amp;lt;-sig
    fmt.Println(&amp;quot;signal caught - exiting&amp;quot;)
    ctx, cancel = context.WithTimeout(context.Background(), 5*time.Second)
    defer cancel()
    _ = cm.Disconnect(ctx)

    fmt.Println(&amp;quot;shutdown complete&amp;quot;)
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;â€¢ Brokeræš´éœ²åœ¨å…¬ç½‘ï¼Œå¦‚ä½•åšå¥½è®¿é—®æ§åˆ¶ï¼Ÿ&lt;br&gt;
â€¢ å‘å¸ƒ/è®¢é˜…æ¨¡å¼ä¸‹ï¼Œå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸‹å‘æˆåŠŸç‡ï¼Ÿ&lt;br&gt;
â€¢ Brokerç”¨åœ¨é€šç”¨åŒ–åœºæ™¯ï¼Œå¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;å¼€æº-mqtt-broker-å¯¹æ¯”&#34;&gt;å¼€æº MQTT Broker å¯¹æ¯”&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç«å“&lt;/th&gt;
&lt;th&gt;å¼€å‘è¯­è¨€&lt;/th&gt;
&lt;th&gt;Staræ•°&lt;/th&gt;
&lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
&lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;EMQX&lt;/td&gt;
&lt;td&gt;erlang&lt;/td&gt;
&lt;td&gt;10.4k&lt;/td&gt;
&lt;td&gt;åŠŸèƒ½å…¨é¢ï¼Œæ–‡æ¡£é½å…¨ï¼Œç¤¾åŒºæ´»è·ƒï¼Œå®Œå–„çš„è¿ç»´é…å¥—&lt;/td&gt;
&lt;td&gt;erlangè¯­è¨€ï¼Œå¯¹äºå…¶ä»–è¯­è¨€çš„å¼€å‘è€…è‡ªå·±æ‰©å±•æœ‰ä¸€å®šéš¾åº¦ã€‚å¼€æºç‰ˆæœ¬ä¸æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mosquitto&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;6.6k&lt;/td&gt;
&lt;td&gt;è¶³å¤Ÿè½»é‡ï¼Œå¯ä»¥è¿è¡Œåœ¨ä»»ä½•ä½åŠŸç‡å•ç‰‡æœºä¸Š&lt;/td&gt;
&lt;td&gt;cå®ç°ï¼Œå¯¹äºå…¶ä»–è¯­è¨€çš„å¼€å‘è€…å¾ˆéš¾æ‰©å±•&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç›®å‰æœ€å¥½é€‰æ‹©æ˜¯&lt;a class=&#34;link&#34; href=&#34;https://www.emqx.io/docs/zh/v5.0/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;EMQX&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ¶ˆæ¯ä¸‹å‘æˆåŠŸç‡&#34;&gt;æ¶ˆæ¯ä¸‹å‘æˆåŠŸç‡&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å‘å¸ƒè´¨é‡ï¼šBrokeræä¾›3ç§QoSï¼Œé€šå¸¸é€‰æ‹©QoS 1æŠ¥æ–‡(è‡³å°‘é€è¾¾ä¸€æ¬¡)æ¥å…¼é¡¾ååé‡å’Œå‘å¸ƒè´¨é‡ã€‚&lt;/li&gt;
&lt;li&gt;è®¢é˜…ç«¯æ–­çº¿é‡è¿ï¼šé€‰æ‹©åˆé€‚çš„å®¢æˆ·ç«¯SDKå¹¶é…ç½®å¯¹åº”å‚æ•°ï¼Œä½¿ç”¨CleanSession=falseæ¥å¼€å¯æŒä¹…åŒ–è®¢é˜…æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½æµ‹è¯•ï¼šç»è¿‡å‹æµ‹å‘ç°ï¼Œæœªç¡®è®¤çš„QoS 1æŠ¥æ–‡æ•°é‡è¶…è¿‡max_mqueue_lenå‚æ•°ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚&lt;/li&gt;
&lt;li&gt;æ¶ˆæ¯çŠ¶æ€ç ï¼šå®¢æˆ·ç«¯SDKéœ€è¦æ”¯æŒMQTT 5.0åè®®ï¼Œè¿™æ ·æ¯æ¬¡connect/pub/subæ“ä½œæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„çŠ¶æ€ç ã€‚&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG206.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG207.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;mqtt-brokeré«˜å¯ç”¨&#34;&gt;MQTT Brokeré«˜å¯ç”¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨HAProxyä½œä¸ºæ•´ä¸ªé›†ç¾¤çš„æ¥å…¥ç‚¹ï¼Œåå‘ä»£ç†MQTT Brokerã€‚&lt;/li&gt;
&lt;li&gt;ç²˜æ€§ä¼šè¯ï¼šåœ¨é‡æ–°è¿æ¥æ—¶å°†å®¢æˆ·ç«¯è·¯ç”±åˆ°ä¹‹å‰æœåŠ¡å™¨ï¼Œä»¥ç²˜æ€§æ–¹å¼åˆ†æ´¾è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;ç›‘æ§å‘Šè­¦ï¼šBrokerå†…ç½®ç›‘æ§ä¸å‘Šè­¦åŠŸèƒ½ï¼Œæ”¯æŒCPUã€å†…å­˜ç­‰èµ„æºçŠ¶æ€è¿›è¡Œå‘Šè­¦ï¼Œç®¡ç†åå°å¯æŸ¥è¯¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG205.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h3 id=&#34;è®¿é—®æ§åˆ¶&#34;&gt;è®¿é—®æ§åˆ¶&lt;/h3&gt;
&lt;h4 id=&#34;å®ç°åŸç†&#34;&gt;å®ç°åŸç†&lt;/h4&gt;
&lt;p&gt;EMQXæœ¬èº«çš„è®¾è®¡æ˜¯æ’ä»¶åŒ–æ¶æ„ï¼Œå¯ç”¨emqx_auth_mysql.confæ’ä»¶ï¼Œæ ¹æ®è¯¥é…ç½®æ–‡ä»¶ä¸­çš„æ¨¡æ¿åŒ–SQLæŸ¥è¯¢è¯­å¥å³å¯å®ç°çµæ´»çš„è®¿é—®æ§åˆ¶ã€‚
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/QQ%E6%88%AA%E5%9B%BE/WechatIMG204.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;è®¤è¯&#34;&gt;è®¤è¯&lt;/h4&gt;
&lt;p&gt;ç”¨æˆ·å/å¯†ç è®¤è¯é˜²æ­¢éæ³•å®¢æˆ·ç«¯è¿æ¥ã€‚
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/WechatIMG203.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;è®¤è¯&#34;
	
	
&gt;&lt;/p&gt;
&lt;h4 id=&#34;æˆæƒ&#34;&gt;æˆæƒ&lt;/h4&gt;
&lt;p&gt;å¯¹ MQTT å®¢æˆ·ç«¯çš„å‘å¸ƒå’Œè®¢é˜…æ“ä½œè¿›è¡Œæƒé™æ§åˆ¶ã€‚æ§åˆ¶å“ªäº›å®¢æˆ·ç«¯å¯ä»¥å‘å¸ƒæˆ–è€…è®¢é˜…å“ªäº›MQTTä¸»é¢˜ã€‚&lt;br&gt;
&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/WechatIMG202.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
		alt=&#34;æˆæƒ&#34;
	
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;å¸¸è§é—®é¢˜&#34;&gt;å¸¸è§é—®é¢˜&lt;/h2&gt;
&lt;h3 id=&#34;æ¶ˆæ¯æŒä¹…åŒ–&#34;&gt;æ¶ˆæ¯æŒä¹…åŒ–&lt;/h3&gt;
&lt;p&gt;MQTTæ¶ˆæ¯publishå‡ºæ¥æ²¡æœ‰æ¥å—è€…å°±ä¼šä¸¢å¤±ï¼ŒæŒä¹…åŒ–çš„èƒ½åŠ›æ˜¯æŒ‡ï¼Œå¯¹æ‰€æœ‰çš„æ¶ˆæ¯è¿›è¡Œè®°å½•ï¼ŒæŠŠæ•°æ®æŒä¹…åŒ–ä¸‹æ¥ã€‚emqxæ˜¯brokerä¸æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŒä¹…åŒ–å±äºæ‹“å±•çš„èƒ½åŠ›ã€‚emqxå¼€æºç‰ˆä¸æ”¯æŒæœåŠ¡å™¨å†…éƒ¨æ¶ˆæ¯æŒä¹…åŒ–ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¶æ„è®¾è®¡é€‰æ‹©ã€‚è€Œä¸”emqx è§£å†³çš„æ ¸å¿ƒé—®é¢˜æ˜¯å¤„ç†æµ·é‡çš„å¹¶å‘ MQTT è¿æ¥ä¸è·¯ç”±æ¶ˆæ¯ï¼Œåœ¨æ¦‚å¿µä¸Šæ›´åƒæ˜¯ç½‘ç»œè·¯ç”±å™¨ï¼Œä¿è¯æœåŠ¡è´¨é‡æ˜¯ç¬¬ä¸€è¦æ±‚ï¼Œå®•æœºçš„å¯èƒ½éå¸¸å°ã€‚&lt;br&gt;
è§£å†³æ–¹æ³•ï¼šæ ¹æ®ä¸šåŠ¡åœºæ™¯å†³å®šæ˜¯å¦éœ€è¦æ‹“å±•æŒä¹…åŒ–åŠŸèƒ½ï¼Œè‹¥éœ€è¦åˆ™é€‰æ‹©emqxä¼ä¸šç‰ˆï¼Œé€šè¿‡è‡ªå¸¦çš„è§„åˆ™å¼•æ“æˆ–æ’ä»¶çš„æ–¹å¼ï¼ŒæŒä¹…åŒ–æ¶ˆæ¯åˆ°Redisã€MongoDBã€MySQLç­‰æ•°æ®åº“ï¼Œä»¥åŠ RabbitMQã€Kafka ç­‰æ¶ˆæ¯é˜Ÿåˆ—ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ–­çº¿é‡è¿æ”¶ä¸åˆ°æ¶ˆæ¯&#34;&gt;æ–­çº¿é‡è¿æ”¶ä¸åˆ°æ¶ˆæ¯&lt;/h3&gt;
&lt;p&gt;è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ CleanSession=falseæ¥å¼€å¯æŒä¹…åŒ–è®¢é˜…æ¨¡å¼ã€‚&lt;br&gt;
å®¢æˆ·ç«¯ä¸‹çº¿åï¼Œemqx ä¼šä¸ºè¿™ä¸ªè®¾å¤‡ä¿ç•™ä¸€ä¸ªä¼šè¯ï¼ˆSessionï¼‰ï¼Œå®ƒåœ¨è¢«æ¸…ç†å‰éƒ½ä¼šä¸€ç›´æ”¶æ¶ˆæ¯ã€‚é™¤éä¼šè¯è¢«æ¸…ç†ï¼ˆé»˜è®¤2hï¼‰ï¼›æ¶ˆæ¯é˜Ÿåˆ—æ»¡äº†ä¹Ÿä¼šä¸¢å¼ƒä¸å†å­˜å‚¨ï¼ˆé»˜è®¤1000ï¼‰ï¼›å­˜å‚¨æ–¹å¼æ˜¯å†…å­˜çš„ï¼Œé‡å¯ä¼šå…¨éƒ¨ä¸¢æ‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿æ¥å¼‚å¸¸æ–­å¼€&#34;&gt;è¿æ¥å¼‚å¸¸æ–­å¼€&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯æœ¬èº«çš„æ¥æ”¶bufferæ»¡äº†ï¼Œbrokeræ”¶ä¸åˆ°å¿ƒè·³åŒ…åˆ™ä¼šè®¤ä¸ºå®¢æˆ·ç«¯å·²ä¸å­˜æ´»ï¼Œä¸»åŠ¨æ–­å¼€è¿æ¥ã€‚å› æ­¤å°½é‡åŠ å¿«å®¢æˆ·ç«¯çš„å¤„ç†é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;ä¸åŒçš„å®¢æˆ·ç«¯ä½¿ç”¨ç›¸åŒçš„Client IDè¿æ¥Brokeræ—¶ï¼Œè¿æ¥ä¼šè¢«å¼ºåˆ¶æ–­å¼€ã€‚å› æ­¤éœ€è¦ç¡®ä¿Client IDå…¨å±€å”¯ä¸€ï¼Œä¸èƒ½é‡å¤ã€‚&lt;/li&gt;
&lt;li&gt;æƒé™ä¸åŒ¹é…ã€‚éœ€è¦æ£€æŸ¥acl.confå’Œemqx_auth_mysql.confé…ç½®æ–‡ä»¶ï¼Œä»¥åŠæ•°æ®åº“ä¸­æ˜¯å¦æˆäºˆäº†pub/subæƒé™ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;brokeré‡å¯è®¢é˜…ç«¯é‡è¿è®¢é˜…æˆåŠŸæ”¶ä¸åˆ°æ¶ˆæ¯&#34;&gt;Brokeré‡å¯ï¼Œè®¢é˜…ç«¯é‡è¿è®¢é˜…æˆåŠŸï¼Œæ”¶ä¸åˆ°æ¶ˆæ¯&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://someblogs.oss-cn-shenzhen.aliyuncs.com/thumb/WechatIMG215.jpg&#34;
	
	
	
	loading=&#34;lazy&#34;
	
	
&gt;
å›¾ä¸­å…³é”®æ—¥å¿—ï¼š[warning] [CM] kicked_an_unknown_session deploy.docer.wps.cn&lt;br&gt;
ä»ç®¡ç†åå°çš„é›†ç¾¤åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹åˆ¤æ–­ï¼Œæ˜¯é›†ç¾¤é—®é¢˜ï¼Œè®¢é˜…ç«¯è™½ç„¶é‡è¿æˆåŠŸä½†è¿æ¥åˆ°äº†æœªåœ¨é›†ç¾¤å†…çš„èŠ‚ç‚¹ï¼Œè®¢é˜…ç«¯ä»¥ä¸ºè®¢é˜…æˆåŠŸï¼Œä½†brokeræ„ŸçŸ¥ä¸åˆ°ï¼Œå‘å¸ƒç«¯å‘é€æ¶ˆæ¯è€Œè®¢é˜…ç«¯æ”¶ä¸åˆ°æ¶ˆæ¯ã€‚&lt;br&gt;
è§£å†³æ–¹æ³•ï¼šBrokeré‡å¯åï¼Œéœ€è¦ç¡®ä¿é™æ€é›†ç¾¤ä¿è¯æœ‰å…¨éƒ¨çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœèŠ‚ç‚¹ç¼ºå¤±ï¼Œæ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼šemqx_ctl cluster join &lt;a class=&#34;link&#34; href=&#34;mailto:emqx@node2.emqx.io&#34; &gt;emqx@node2.emqx.io&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦æ˜¯ä»‹ç»MQTTæ¶ˆæ¯æœåŠ¡å™¨åœ¨ç¨»å£³æœåŠ¡è½åœ°çš„å®æˆ˜è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚MQTTæ¶ˆæ¯æœåŠ¡å™¨ç›®å‰å®ç°äº†åè®®æ¥å…¥ã€é›†ç¾¤éƒ¨ç½²ã€æ¥å…¥å®‰å…¨ç­‰ä¸»è¦åŠŸèƒ½ï¼Œèƒ½ç¨³å®šæ‰¿è½½ç™¾åˆ†çº§å®¢æˆ·ç«¯è¿æ¥ã€‚ç¨»å£³çš„å¾ˆå¤šä¸šåŠ¡åœºæ™¯éƒ½å¯ä»¥æ¥å…¥MQTTæ¶ˆæ¯æœåŠ¡å™¨çš„å‘å¸ƒè®¢é˜…èƒ½åŠ›æ¥ææ•ˆå’Œç²¾å‡†è§¦è¾¾ç”¨æˆ·ï¼Œèƒ½ä¸ºä¸šåŠ¡å¸¦æ¥ä¸€å®šçš„ä»·å€¼ã€‚&lt;/p&gt;</description>
        </item>
        
    </channel>
</rss>
